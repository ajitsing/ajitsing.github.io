{% if layout.common-ext-js %}
  {% for js in layout.common-ext-js %}
    {% include ext-js.html js=js %}
  {% endfor %}
{% endif %}

{% if layout.common-js %}
  {% for js in layout.common-js %}
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    {% if js contains 'jquery' %}
      <script>
        if (typeof jQuery == 'undefined') {
          document.write('<script src="{{ js | relative_url }}"></scr' + 'ipt>');
        }
      </script>
    {% else %}
      <script src="{{ js | relative_url }}"></script>
    {% endif %}
  {% endfor %}
{% endif %}

{% if page.ext-js %}
  {% for js in page.ext-js %}
    {% include ext-js.html js=js %}
  {% endfor %}
{% endif %}

{% if page.js %}
  {% for js in page.js %}
    <script src="{{ js | relative_url }}"></script>
  {% endfor %}
{% endif %}

<!-- Mermaid Support -->
{% if page.content contains 'language-mermaid' or content contains 'language-mermaid' %}
<script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize mermaid
    mermaid.initialize({
      startOnLoad: false,
      theme: 'default',
      themeVariables: {
        fontFamily: 'Open Sans, sans-serif'
      }
    });
    
    // Convert code blocks with language-mermaid class to mermaid divs
    var mermaidBlocks = document.querySelectorAll('pre code.language-mermaid');
    for (var i = 0; i < mermaidBlocks.length; i++) {
      var code = mermaidBlocks[i];
      var pre = code.parentNode;
      var div = document.createElement('div');
      div.className = 'mermaid';
      div.textContent = code.textContent;
      div.style.textAlign = 'center';
      div.style.backgroundColor = 'transparent';
      pre.parentNode.replaceChild(div, pre);
    }
    
    // Now render all mermaid diagrams
    mermaid.run();
  });
</script>
{% endif %}
